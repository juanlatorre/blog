{"data":{"markdownRemark":{"html":"<h1>Formulario de Contacto para Sitio Estático</h1>\n<p>Dado que este blog es un <em><em>sitio estático</em></em>, tuve que buscar alternativas para poder enviar un formulario de contacto sin la necesidad de tener backend o un servidor dedicado para eso.</p>\n<p><span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 650px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 89.08819133034379%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsSAAALEgHS3X78AAAC2ElEQVQ4y31UCW7cMAz0//9XNCiSXd+yLV+S70OeDrXJNgnaGuAOSWkpckQqcO7COE4YhhHTNFEfMVDWdcV1XXDOwXm8nvj0e3nY8+pwUg+uy2EaDKzpGXSAtRZd12OeZ3x88oe/4Wd92cEDgeDgb9IB60lZFgZa/AbJ9jydP2Tfd29v2+YPOs/THywiuvisMVj4/2BipFDPaOxKx4yZsm6rX9z2zdv7sYNFQqqRAFKq4Gf9OA6PgTimfsTYk8eO/BFNa4kDRiO29b59ObHz8M/lfi9fvkBILVWHPG5Q5C0abVHFI6pkhs5mlMS+XGDKGVO3MQL++Unw4HQn7vkdYR7ilt0QqRBJqhAnFeK4wO2m0LQNjO3Qdg2apvF0GHLW973nUXyC7xk66Mqg1oNHXckGi7ruUFWdR7GzrIZSjefqI5vv4gMKrgv7aHIel9kxg+vdJ/ZXXUrm3fj++xuXwcHW+HWvcU9bYoUwa3GLW0Tk8zVqcE9avLzWiMmz+F7eKryFBm9vI7TeeLhjO11fOVR1gVwrpFWGuEiQlpnXkyJloARZ+dBz7st0jqZrkTO44iEpE9HaPAchkKjGGjawZfMO6I2Q35LwxyUYTlClS05P+z6Gp5fj3DhqO/WD+u6b/hGQXAx69dKrGWO9Yu52LD2no90xC9Y711mePTA2K2y1eP/MNhL73Nznkh0SpSgFoiyHKjVUxZZROcI09Wsx/amsq4x7Mt56jzzhzccWaWSRZ48RfLZNSW4KTR7JlSpzxGnMIDEylSJKQq8neYKqLmGGHtM8kgpLGfgyTb615HV6cigjdewOB1M/9wsb7fO4vC548BZl/XokQd9/JkX6KUoNM7AIk55l8uaoq2rALWqZXc82aZ92qnrco55ZrXyFHG/3oPyZ8UBellt2x4/Xn7hx/FRXorYNyq5C3hZQbYmCPm1qr4uY0ZDHie0yoSxGlKU8yJt/5n4DBQVpwDPnn7oAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"búsqueda de google\"\n        title=\"\"\n        src=\"/static/84f76a865bdbe4e2018a0b0146bd75a7/ccaa4/formulario-de-contacto-para-sitio-estatico-1.png\"\n        srcset=\"/static/84f76a865bdbe4e2018a0b0146bd75a7/4d3a0/formulario-de-contacto-para-sitio-estatico-1.png 163w,\n/static/84f76a865bdbe4e2018a0b0146bd75a7/c6041/formulario-de-contacto-para-sitio-estatico-1.png 325w,\n/static/84f76a865bdbe4e2018a0b0146bd75a7/ccaa4/formulario-de-contacto-para-sitio-estatico-1.png 650w,\n/static/84f76a865bdbe4e2018a0b0146bd75a7/39468/formulario-de-contacto-para-sitio-estatico-1.png 669w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n      />\n  </span></p>\n<p>Obviamente al hacer la búsqueda en Google me encuentro con que la opción más usada y famosa es <a href=\"https://formspree.io\">Formspree</a>.</p>\n<blockquote>\n<h4>¿Qué es Formspree?</h4>\n<p>Connect your form to our endpoint and we’ll email you the submissions. No PHP, Javascript or sign up required —  <em>perfect for static sites!</em></p>\n</blockquote>\n<pre><code>&#x3C;form action=\"https://formspree.io/your@email.com\" method=\"POST\">\n    &#x3C;input type=\"text\" name=\"name\">  \n    &#x3C;input type=\"email\" name=\"_replyto\">\n    &#x3C;input type=\"submit\" value=\"Send\"> \n&#x3C;/form>\n</code></pre>\n<p>Así de sencillo, ya tendría funcionando un formulario de contacto en mi sitio estático, todo bien... pero no.</p>\n<p>Resulta que al enviar el formulario con Formspree, nos encontramos con esta maravilla.</p>\n<p><span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 650px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 58.279009126466754%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsSAAALEgHS3X78AAABR0lEQVQoz5WT23KCMBCGff+X8Ul6YdUqHe0FYOUQQhJyAMaZv5s4YFGr9uInu+zmy2l31rYOXdfCj/fkY69oyJ35j7Uaxgh0rUbrmiBvO6fQNIJUX0kEaX2OGaNGaAA6p3HMUrwtF1hFH3jfrIMdfX1CSkaTKih1kf93URnAN8DvLMFys8Jqu0a0i4Id7baoqgyMHYO87eVBv+FayynQmAaiLlCxDDUvSHlQRZCiOKDID8jzdNQtUFwDFQU5jLWQSlKSJF9RQofTqcciKpGVAtb4++Mj6CFQSk4BDc457YyF0TkX4HGcoCyLCejJkVW43PMDcDT6vBPvC8HuPMTTRzFhlSBFsJqNpWGMfCg/x5fdCBwK0vjj0v3x/R7JfI74kCJNYlrMUrz7X2EHZ+gYa+AI3PcDxP3ZRdcdNdnhpNUIdi/5lRb8AQcLmB3ezbkqAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"búsqueda de google\"\n        title=\"\"\n        src=\"/static/9ea69958321cc0788fef9404c80d77eb/ccaa4/formulario-de-contacto-para-sitio-estatico-2.png\"\n        srcset=\"/static/9ea69958321cc0788fef9404c80d77eb/4d3a0/formulario-de-contacto-para-sitio-estatico-2.png 163w,\n/static/9ea69958321cc0788fef9404c80d77eb/c6041/formulario-de-contacto-para-sitio-estatico-2.png 325w,\n/static/9ea69958321cc0788fef9404c80d77eb/ccaa4/formulario-de-contacto-para-sitio-estatico-2.png 650w,\n/static/9ea69958321cc0788fef9404c80d77eb/6f992/formulario-de-contacto-para-sitio-estatico-2.png 767w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n      />\n  </span></p>\n<p>Un <strong><em>Captcha</em></strong> !!!!</p>\n<p>Definitivamente descartado, eliminar el anti-spam no es posible en el plan gratuito de formspree, entonces, ¿qué otra alternativa existe?</p>\n<p>Bueno, respuestas a esta pregunta hay muchas, servicios que hacen exactamente lo mismo como:</p>\n<ul>\n<li><a href=\"https://formkeep.com/\">FormKeep</a></li>\n<li><a href=\"https://liveformhq.com/\">LiveForm</a></li>\n<li><a href=\"https://formcarry.com/\">FormCarry</a></li>\n<li><a href=\"https://www.formbucket.com/\">FormBucket</a></li>\n</ul>\n<p>Pero buscando alternativas encontré algo que me llamó mucho la atención; es posible utilizar Google Docs para simular un backend y guardar el registro de mensajes en el formulario de contacto en una planilla, para luego enviarlo a mi correo.</p>\n<p>¿Overkill? Totalmente, pero interesante <em>as fuck</em>.</p>\n<p>Así que decidí implementarlo en el sitio siguiendo las instrucciones del siguiente repositorio -> <a href=\"https://github.com/dwyl/learn-to-send-email-via-google-script-html-no-server\">https://github.com/dwyl/learn-to-send-email-via-google-script-html-no-server</a></p>\n<ol>\n<li>\n<p>Primero hay que copiar la <a href=\"https://docs.google.com/spreadsheets/d/1Bn4m6iA_Xch1zzhNvo_6CoQWqOAgwwkOWJKC-phHx2Q/copy\">siguiente planilla</a> en nuestra cuenta de Google Drive.</p>\n</li>\n<li>\n<p>Abrimos el <strong>Editor  de Secuencias de Comando</strong> haciendo click en <strong>Herramientas</strong> > <strong>Editor de Secuencias de Comando</strong>.</p>\n</li>\n<li>\n<p>Copiamos el siguiente <em>script</em> y editamos la variable <em>TO_ADDRESS</em>.</p>\n<pre><code>var TO_ADDRESS = \"mi@correo.com\";\n\nfunction doPost(e) {\n    try {\n        Logger.log(e);\n        MailApp.sendEmail(TO_ADDRESS, \"Formulario de Contacto Enviado\", JSON.stringify(e.parameters));\n        return ContentService.createTextOutput(\n            JSON.stringify({\"result\":\"success\", \"data\": JSON.stringify(e.parameters) }))\n                .setMimeType(ContentService.MimeType.JSON);\n    } catch(error) {\n        Logger.log(error);\n        return ContentService\n            .createTextOutput(JSON.stringify({\"result\":\"error\", \"error\": e}))\n            .setMimeType(ContentService.MimeType.JSON);\n    }\n}\n</code></pre>\n</li>\n<li>\n<p>Guardar el script como una <em>nueva versión</em>, para hacerlo, ir a <strong>Archivo</strong> > <strong>Administrar Versiones</strong>, ahí escribes un título y guardas la nueva versión.</p>\n</li>\n<li>\n<p>Publicar el script, para ello, vamos a <strong>Publicar</strong> > <strong>Implementar como aplicación web...</strong>, siempre fijarse en que la <em>Versión del Proyecto</em> sea la última.</p>\n</li>\n<li>\n<p>Apretar <em>Actualizar</em> y aceptar los correspondientes permisos, el resultado será una <em>URI</em>, guardar para el próximo paso.</p>\n</li>\n</ol>\n<h3>HTML</h3>\n<p>Ahora que tenemos el formulario listo para recibir los mensajes, tenemos que implementarlo a un formulario html que debe cumplir con las siguientes condiciones:</p>\n<ul>\n<li>La clase del <code>&#x3C;form></code>debe ser <strong>gform</strong>.</li>\n<li>El atributo <em>name</em> de cada <code>&#x3C;input></code> debe ser el mismo que su correspondiente columna en la planilla de Google.</li>\n<li>El <em>action</em> del formulario debe ser la <em>URI</em> obtenida anteriormente.</li>\n</ul>\n<p><span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 650px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 45.58823529411765%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsSAAALEgHS3X78AAABU0lEQVQoz52R626DMAyFef+H2d/tKSZt9AItZVovUCBckgCl0PrMeEVr97ORPsX44GMncYoyoaJKadwrnVGmIgo2Hm1Cj/zVnNbBgmOfFstPyYVfK/L9Ga1Yy4sjlbfaycPhBCY4gTTdIwx9LH0X88UHlt4nVuu5xGyOIFjC81y47jvS7CA19x6OuDNTJzakPI8pzfZCpg6CNopUHommJBfRMdneTZlSyThTBxYQxd9QefzQla8Bx2QnTKeY8nKi25QTTqUVBwrWVtC6RNvW6M4ttCmgVCKaMb9a17U4nWpUVc6NU76eIw6HrWhnrjG2gDMWaq35w6BpajbSbG4xDD36vpf9Slfhcrkww4MmcHxlrW40nKa1GBfRCN3AU6s9N3Cs5XH7jkc+PTAe+4/TP1o5ftfzv8Zg2EYYdjFsEssr4yn4EXObodysUb+8Mm/Qsxl+APymqaQOO7FvAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"búsqueda de google\"\n        title=\"\"\n        src=\"/static/adb9bbf11b353dbfc0af76f97d36c9e6/ccaa4/formulario-de-contacto-para-sitio-estatico-3.png\"\n        srcset=\"/static/adb9bbf11b353dbfc0af76f97d36c9e6/4d3a0/formulario-de-contacto-para-sitio-estatico-3.png 163w,\n/static/adb9bbf11b353dbfc0af76f97d36c9e6/c6041/formulario-de-contacto-para-sitio-estatico-3.png 325w,\n/static/adb9bbf11b353dbfc0af76f97d36c9e6/ccaa4/formulario-de-contacto-para-sitio-estatico-3.png 650w,\n/static/adb9bbf11b353dbfc0af76f97d36c9e6/5ed4d/formulario-de-contacto-para-sitio-estatico-3.png 975w,\n/static/adb9bbf11b353dbfc0af76f97d36c9e6/9a5ee/formulario-de-contacto-para-sitio-estatico-3.png 1020w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n      />\n  </span></p>\n<p>Con eso tenemos lista la integración, al probarlo obtuve algo como esto:</p>\n<pre><code>{\"result\":\"success\",\"data\":\"{\\\"correo\\\":[\\\"juanlatorreharcha@gmail.com\\\"],\\\"mensaje\\\":[\\\"Hola, este es un mensaje de prueba.\\\"],\\\"telefono\\\":[\\\"973362531\\\"],\\\"nombre\\\":[\\\"Juan Latorre\\\"]}\"}\n</code></pre>\n<p><span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 650px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 28.75751503006012%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsSAAALEgHS3X78AAAA1UlEQVQY04WO224CMQxE8/+fWNHsLsnm1s2d9gXYwY4AtWpFoxzN2B5HEWY1cNYhOA9n7PCWesEH7Ncd++X6D/vIgW6vHUIeNKZ3jVkaSFJ5UFgmg2W28K4Q+QUF1kSoxeFIeVYhlQMzaQ9lI7RPWH0mzVjDX5QfcE659ES8SYdZBxzNNh4yoRL3Bf8bTT/TtGj9Bm08bGAfYd2Gj9ggYm5IpYN1S5WaZcD+QUxtzJnSPlH7F9qJ+K53L0rOqLWilIzeO1JKpG30TlTznJVr5nI+49W5AUQ/xjtu0l62AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"búsqueda de google\"\n        title=\"\"\n        src=\"/static/8816956ce8d1d1310099ce6a71c50fcc/ccaa4/formulario-de-contacto-para-sitio-estatico-4.png\"\n        srcset=\"/static/8816956ce8d1d1310099ce6a71c50fcc/4d3a0/formulario-de-contacto-para-sitio-estatico-4.png 163w,\n/static/8816956ce8d1d1310099ce6a71c50fcc/c6041/formulario-de-contacto-para-sitio-estatico-4.png 325w,\n/static/8816956ce8d1d1310099ce6a71c50fcc/ccaa4/formulario-de-contacto-para-sitio-estatico-4.png 650w,\n/static/8816956ce8d1d1310099ce6a71c50fcc/5ed4d/formulario-de-contacto-para-sitio-estatico-4.png 975w,\n/static/8816956ce8d1d1310099ce6a71c50fcc/fa5f3/formulario-de-contacto-para-sitio-estatico-4.png 998w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n      />\n  </span></p>\n<p>Perfecto, ahora solo falta mejorarlo un poco, no quiero que la persona que me contacta vea ese gran mensaje después de enviar el formulario.</p>\n<p>Para eso vamos a modificar un poco el script (primera parte, paso 2).</p>\n<p>Primero agrego la función <code>formatMailBody()</code> para mejorar un poco el <em>look</em> del correo recibido.</p>\n<pre><code>function formatMailBody(obj, order) {\n    var result = \"\";\n    if (!order) {\n        order = Object.keys(obj);\n    }\n    for (var idx in order) {\n        var key = order[idx];\n        result += \"&#x3C;h4 style='text-transform: capitalize; margin-bottom: 0'>\" + key + \"&#x3C;/h4>&#x3C;div>\" + sanitizeInput(obj[key]) + \"&#x3C;/div>\";\n    }\n    return result;\n}\n</code></pre>\n<p>Pero esta función utiliza a su vez, otra función que limpia o sanitiza el <em>input</em> ingresado por la persona que quiere contartarme; así que agregaremos la función <code>sanitizeInput</code>también.</p>\n<pre><code>function sanitizeInput(rawInput) {\n    var placeholder = HtmlService.createHtmlOutput(\" \");\n    placeholder.appendUntrusted(rawInput);\n    return placeholder.getContent();\n}\n</code></pre>\n<p>Y por supuesto teniendo dos nuevas funciones, hay que agregarlas a nuestro loop principal, que ahora queda así:</p>\n<pre><code>function doPost(e) {\n    try {\n        Logger.log(e);\n        record_data(e);\n        var mailData = e.parameters;\n        var orderParameter = e.parameters.formDataNameOrder;\n        var dataOrder;\n        if (orderParameter) {\n            dataOrder = JSON.parse(orderParameter);\n        }\n        var sendEmailTo = (typeof TO_ADDRESS !== \"undefined\") ? TO_ADDRESS : mailData.formGoogleSendEmail;\n        if (sendEmailTo) {\n            MailApp.sendEmail({\n                to: String(sendEmailTo),\n                subject: \"Contact form submitted\",\n                htmlBody: formatMailBody(mailData, dataOrder)\n            });\n        }\n        return ContentService.createTextOutput(\n            JSON.stringify({\"result\":\"success\",\n            \"data\": JSON.stringify(e.parameters) }))\n               .setMimeType(ContentService.MimeType.JSON);\n    } catch(error) {\n        Logger.log(error);\n        return ContentService\n            .createTextOutput(JSON.stringify({\"result\":\"error\", \"error\": error}))\n            .setMimeType(ContentService.MimeType.JSON);\n    }\n}\n</code></pre>\n<p>Sin embargo, nos falta la función para guardar los datos en la planilla creada al comienzo, por lo que la agregamos también.</p>\n<pre><code>function record_data(e) {\n  var lock = LockService.getDocumentLock();\n  lock.waitLock(30000);\n  \n  try {\n    Logger.log(JSON.stringify(e));\n    var doc = SpreadsheetApp.getActiveSpreadsheet();\n    var sheetName = e.parameters.formGoogleSheetName || \"responses\";\n    var sheet = doc.getSheetByName(sheetName);\n    \n    var oldHeader = sheet.getRange(1, 1, 1, sheet.getLastColumn()).getValues()[0];\n    var newHeader = oldHeader.slice();\n    var fieldsFromForm = getDataColumns(e.parameters);\n    var row = [new Date()];\n    \n    // loop through the header columns\n    for (var i = 1; i &#x3C; oldHeader.length; i++) {\n      var field = oldHeader[i];\n      var output = getFieldFromData(field, e.parameters);\n      row.push(output);\n      \n      var formIndex = fieldsFromForm.indexOf(field);\n      if (formIndex > -1) {\n        fieldsFromForm.splice(formIndex, 1);\n      }\n    }\n    \n    for (var i = 0; i &#x3C; fieldsFromForm.length; i++) {\n      var field = fieldsFromForm[i];\n      var output = getFieldFromData(field, e.parameters);\n      row.push(output);\n      newHeader.push(field);\n    }\n    \n    var nextRow = sheet.getLastRow() + 1;\n    sheet.getRange(nextRow, 1, 1, row.length).setValues([row]);\n\n    if (newHeader.length > oldHeader.length) {\n      sheet.getRange(1, 1, 1, newHeader.length).setValues([newHeader]);\n    }\n  }\n  catch(error) {\n    Logger.log(error);\n  }\n  finally {\n    lock.releaseLock();\n    return;\n  }\n\n}\n\nfunction getDataColumns(data) {\n  return Object.keys(data).filter(function(column) {\n    return !(column === 'formDataNameOrder' || column === 'formGoogleSheetName' || column === 'formGoogleSendEmail' || column === 'honeypot');\n  });\n}\n\nfunction getFieldFromData(field, data) {\n  var values = data[field] || '';\n  var output = values.join ? values.join(', ') : values;\n  return output;\n}\n</code></pre>\n<p>y <em>voilá</em>, tenemos un formulario de contacto estático.</p>","frontmatter":{"title":"Formulario de Contacto para Sitio Estático"}}},"pageContext":{"slug":"/blog/formulario-de-contacto-para-sitio-estatico/"}}